<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ config.title }} - {{ report_date.strftime('%B %d, %Y') }}</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=Source+Sans+Pro:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script>
        // Dark mode toggle
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('dark-mode', isDark);
            document.getElementById('theme-toggle').textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
        }
        
        // Load saved theme
        document.addEventListener('DOMContentLoaded', function() {
            const savedTheme = localStorage.getItem('dark-mode');
            if (savedTheme === 'true') {
                document.body.classList.add('dark-mode');
                document.getElementById('theme-toggle').textContent = '‚òÄÔ∏è';
            }
        });
    </script>
</head>
<body>
    <header class="header">
        <div class="header-top">
            <div class="date-time">{{ report_date.strftime('%A, %B %d, %Y') }}</div>
            <button id="theme-toggle" class="theme-toggle" onclick="toggleDarkMode()">üåô</button>
        </div>
        <div class="masthead">
            <h1 class="title">{{ config.title }}</h1>
            <div class="subtitle">{{ config.subtitle }}</div>
        </div>
        <div class="summary-bar">
            <span class="update-count">{{ total_updates }} New Updates Today</span>
            <span class="categories-count">{{ categories|length }} Categories</span>
            <span class="generated-time">Generated at {{ generated_at.strftime('%I:%M %p') }}</span>
        </div>
    </header>

    <main class="main-content">
        {% if categories %}
            <div class="top-stories">
                <h2 class="section-title">Today's Headlines</h2>
                <div class="headlines-grid">
                    {% for category_key, updates in categories.items() %}
                        {% if updates and category_key != 'other' %}
                            {% for update in updates[:2] %}
                                <article class="headline-card priority-{{ update.importance_score|int }}">
                                    <div class="category-tag">{{ category_info[category_key].title }}</div>
                                    <h3 class="headline-title">
                                        <a href="{{ update.url }}" target="_blank" rel="noopener">{{ update.title }}</a>
                                    </h3>
                                    <div class="headline-meta">
                                        <span class="source">{{ update.source|upper }}</span>
                                        <span class="time">{{ update.published_date.strftime('%I:%M %p') }}</span>
                                        {% if update.importance_score >= 8 %}
                                            <span class="breaking">BREAKING</span>
                                        {% endif %}
                                    </div>
                                    {% if update.content %}
                                        <p class="headline-summary">{{ update.content[:200] }}...</p>
                                    {% endif %}
                                </article>
                            {% endfor %}
                        {% endif %}
                    {% endfor %}
                </div>
            </div>

            {% for category_key, updates in categories.items() %}
                {% if updates and category_key != 'other' %}
                    <section class="category-section">
                        <div class="section-header">
                            <h2 class="section-title">{{ category_info[category_key].title }}</h2>
                            <span class="section-count">{{ updates|length }} updates</span>
                        </div>
                        
                        <div class="articles-grid">
                            {% for update in updates %}
                                <article class="article-card priority-{{ update.importance_score|int }}">
                                    <div class="article-header">
                                        <h3 class="article-title">
                                            <a href="{{ update.url }}" target="_blank" rel="noopener">
                                                {{ update.title }}
                                            </a>
                                        </h3>
                                        <div class="article-meta">
                                            <span class="source">{{ update.source|upper }}</span>
                                            <span class="time">{{ update.published_date.strftime('%m/%d %I:%M%p') }}</span>
                                            <span class="score">Score: {{ update.importance_score|round(1) }}</span>
                                        </div>
                                    </div>
                                    
                                    {% if update.content %}
                                        <div class="article-content">
                                            <p>{{ update.content[:300] }}{% if update.content|length > 300 %}...{% endif %}</p>
                                        </div>
                                    {% endif %}
                                    
                                    {% if update.metadata %}
                                        <div class="article-tags">
                                            {% set metadata = update.metadata|from_json %}
                                            {% if metadata.version %}
                                                <span class="tag">v{{ metadata.version }}</span>
                                            {% endif %}
                                            {% if metadata.repo %}
                                                <span class="tag">{{ metadata.repo }}</span>
                                            {% endif %}
                                            {% if metadata.type %}
                                                <span class="tag">{{ metadata.type }}</span>
                                            {% endif %}
                                        </div>
                                    {% endif %}
                                </article>
                            {% endfor %}
                        </div>
                    </section>
                {% endif %}
            {% endfor %}

            {% if categories.other %}
                <section class="category-section other-section">
                    <div class="section-header">
                        <h2 class="section-title">Other Updates</h2>
                        <span class="section-count">{{ categories.other|length }} updates</span>
                    </div>
                    
                    <div class="other-updates">
                        {% for update in categories.other %}
                            <div class="other-update">
                                <a href="{{ update.url }}" target="_blank" rel="noopener" class="other-link">
                                    {{ update.title }}
                                </a>
                                <span class="other-meta">{{ update.source|upper }} - {{ update.published_date.strftime('%m/%d') }}</span>
                            </div>
                        {% endfor %}
                    </div>
                </section>
            {% endif %}
        {% else %}
            <div class="no-updates">
                <h2>No New Updates Today</h2>
                <p>No significant updates were found in the monitored sources. Check back tomorrow!</p>
            </div>
        {% endif %}
    </main>

    <footer class="footer">
        <div class="footer-content">
            <p>&copy; {{ report_date.year }} AI Intelligence Briefing System</p>
            <p>Generated automatically at {{ generated_at.strftime('%I:%M %p') }} | Next update tomorrow at 5:00 AM</p>
        </div>
    </footer>
</body>
</html>